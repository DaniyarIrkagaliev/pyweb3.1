#!/bin/bash

# Остановка всех запущенных контейнеров
echo "Остановка всех работающих контейнеров..."
docker stop $(docker ps -q)

# Удаление всех остановленных контейнеров
echo "Удаление всех остановленных контейнеров..."
docker container prune -f

# Удаление всех неиспользуемых образов
echo "Удаление всех неиспользуемых образов..."
docker image prune -af

# Удаление всех неиспользуемых сетей
echo "Удаление всех неиспользуемых сетей..."
docker network prune -f

# Удаление всех неиспользуемых томов
echo "Удаление всех неиспользуемых томов..."
docker volume prune -f

# Полная очистка системы Docker
echo "Полная очистка системы Docker..."
docker system prune -af

# Удаление выбранных образов
echo "Удаление выбранного образа..."
docker rmi <image_id>

# Удаление выбранных контейнеров
echo "Удаление выбранного контейнера..."
docker rm <container_id>

# Построение образа с объединёнными слоями (может увеличить время сборки)
echo "Создание образа с объединенными слоями..."
docker build --squash .

# Удаление неиспользуемых данных сборщика образов (может увеличить время последующих сборок)
echo "Удаление неиспользуемых данных сборщика образов..."
docker builder prune -f

echo "Все задачи выполнены успешно!"
